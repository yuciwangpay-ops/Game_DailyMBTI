<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PersonaPact å‘½é‹å¥‘ç´„</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    /* é€™è£¡å·²ç¶“ä¿®æ­£ä¹¾æ·¨äº†ï¼Œç§»é™¤äº†å¥‡æ€ªçš„æ–¹å¡Šç¬¦è™Ÿ */
    body { background-color: #1a1a1a; color: #fff; font-family: 'Noto Sans TC', sans-serif; padding: 20px; }
    .card { background-color: #2c2c2c; border: 1px solid #444; margin-bottom: 15px; }
    .btn-custom { width: 100%; margin-top: 10px; padding: 12px; }
    .hidden { display: none; }
    #loading { text-align: center; margin-top: 50px; }
  </style>
</head>
<body>

  <div id="loading">
    <div class="spinner-border text-light" role="status"></div>
    <p class="mt-2">æ­£åœ¨é€£çµè³‡æ–™åº«...</p>
    <small class="text-muted" id="debugMsg">åˆå§‹åŒ–...</small>
  </div>

  <div id="mainContent" class="hidden">
    <h3 class="mb-4">âš”ï¸ éŠæˆ²æ§åˆ¶å°</h3>
    <div class="card p-3">
        <p>æ­¡è¿, <span id="userName">...</span></p>
        <button class="btn btn-primary btn-custom" onclick="testBackend()">ğŸ“¡ æ¸¬è©¦å¾Œç«¯é€£ç·š</button>
    </div>
  </div>

  <script>
    // ==========================================
    // âš ï¸ è¨­å®šå€ (è«‹è¨˜å¾—ä¿®æ”¹é€™è£¡ï¼)
    // ==========================================
    
    // 1. è«‹å¡«å…¥ GAS éƒ¨ç½²çš„ç¶²å€ (ä»¥ exec çµå°¾)
    const GAS_API_URL = "è«‹è²¼ä¸Šæ‚¨çš„_GAS_API_URL"; 
    
    // 2. è«‹å¡«å…¥ LIFF ID
    const LIFF_ID = "è«‹è²¼ä¸Šæ‚¨çš„_LIFF_ID";

    // ==========================================
    // ğŸš€ æ ¸å¿ƒé‚è¼¯
    // ==========================================
    
    async function main() {
      const debugEl = document.getElementById('debugMsg');
      
      try {
        debugEl.innerText = "æ­£åœ¨åˆå§‹åŒ– LIFF...";
        await liff.init({ liffId: LIFF_ID });
        
        if (!liff.isLoggedIn()) {
          debugEl.innerText = "ä½¿ç”¨è€…æœªç™»å…¥ï¼Œè·³è½‰ä¸­...";
          liff.login();
          return;
        }

        const profile = await liff.getProfile();
        document.getElementById('userName').innerText = profile.displayName;
        
        // é¡¯ç¤ºä¸»ç•«é¢
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('mainContent').classList.remove('hidden');

      } catch (err) {
        debugEl.innerText = "éŒ¯èª¤: " + err.message;
        alert("å•Ÿå‹•å¤±æ•—: " + err);
      }
    }

    async function testBackend() {
      if(GAS_API_URL.includes("è«‹è²¼ä¸Š")) {
        alert("è«‹å…ˆåœ¨ GitHub ç¨‹å¼ç¢¼ä¸­å¡«å…¥ GAS ç¶²å€ï¼");
        return;
      }

      try {
        const profile = await liff.getProfile();
        // å‘¼å« GAS
        const response = await fetch(GAS_API_URL, {
          method: "POST",
          body: JSON.stringify({ 
            action: "test_connection", 
            userId: profile.userId
          })
        });
        
        const result = await response.json();
        alert("å¾Œç«¯å›æ‡‰: " + JSON.stringify(result));
        
      } catch (e) {
        alert("é€£ç·šå¤±æ•—: " + e);
      }
    }

    main();
  </script>
</body>
</html>